# Redmine App Notifications è¨­å®šæ‰‹é †æ›¸

## æ¦‚è¦

æ—¢å­˜ã®Redmine App Notificationsãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®äº’æ›æ€§å•é¡Œã«ã‚ˆã‚Šã€**View Customize Plugin**ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªå†…é€šçŸ¥æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥APIã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€è¦–è¦šçš„é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’çµ„ã¿åˆã‚ã›ãŸåŒ…æ‹¬çš„ãªé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¾ã™ã€‚

## å®Ÿè£…æ©Ÿèƒ½

### 1. ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
- ãƒ˜ãƒƒãƒ€ãƒ¼ã«é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼è¡¨ç¤º
- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é€šçŸ¥ãƒªã‚¹ãƒˆ
- æœªèª­/æ—¢èª­ç®¡ç†
- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã®é€šçŸ¥å±¥æ­´ä¿å­˜

### 2. ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥
- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥ï¼ˆè¨±å¯ãŒå¿…è¦ï¼‰
- ãƒã‚±ãƒƒãƒˆæ›´æ–°ã€æ–°è¦ä½œæˆæ™‚ã®è‡ªå‹•é€šçŸ¥
- ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³

### 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- å®šæœŸçš„ãªãƒã‚±ãƒƒãƒˆå¤‰æ›´ãƒã‚§ãƒƒã‚¯
- è‡ªå‹•é€šçŸ¥ç”Ÿæˆ
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‹•ä½œ

## è¨­å®šæ‰‹é †

### 1. ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

#### åŸºæœ¬è¨­å®š
- **åå‰**: Redmine ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
- **ã‚³ãƒ¡ãƒ³ãƒˆ**: ãƒ˜ãƒƒãƒ€ãƒ¼ã«é€šçŸ¥æ©Ÿèƒ½ã‚’è¿½åŠ 
- **æœ‰åŠ¹**: âœ“ ãƒã‚§ãƒƒã‚¯
- **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ**: âœ— ãƒã‚§ãƒƒã‚¯è§£é™¤ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§åˆ©ç”¨ï¼‰

#### é©ç”¨æ¡ä»¶
- **ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³**: `.*`ï¼ˆå…¨ãƒšãƒ¼ã‚¸ï¼‰
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**: ï¼ˆç©ºæ¬„ = å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰

#### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®š
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¿ã‚¤ãƒ—**: JavaScript
- **æŒ¿å…¥ä½ç½®**: html_body_bottom

#### JavaScript ã‚³ãƒ¼ãƒ‰

```javascript
$(document).ready(function() {
    // é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
    var NotificationSystem = {
        notifications: [],
        unreadCount: 0,
        lastCheck: new Date(),
        storageKey: 'redmine_notifications_' + (window.current_user_id || 'guest'),

        init: function() {
            this.loadNotifications();
            this.createNotificationUI();
            this.startPeriodicCheck();
            this.requestNotificationPermission();
        },

        // é€šçŸ¥UIã®ä½œæˆ
        createNotificationUI: function() {
            var notificationHtml = `
                <div id="notification-system" style="position: fixed; top: 10px; right: 10px; z-index: 10000;">
                    <div id="notification-bell" style="
                        background: #2196F3;
                        color: white;
                        padding: 10px;
                        border-radius: 50%;
                        cursor: pointer;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                        position: relative;
                        user-select: none;
                        transition: all 0.3s;
                    ">
                        ğŸ””
                        <span id="notification-count" style="
                            position: absolute;
                            top: -5px;
                            right: -5px;
                            background: #f44336;
                            color: white;
                            border-radius: 50%;
                            width: 20px;
                            height: 20px;
                            font-size: 12px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: bold;
                            display: none;
                        ">0</span>
                    </div>
                    <div id="notification-dropdown" style="
                        position: absolute;
                        top: 50px;
                        right: 0;
                        background: white;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                        width: 320px;
                        max-height: 400px;
                        overflow-y: auto;
                        display: none;
                        z-index: 10001;
                    ">
                        <div id="notification-header" style="
                            padding: 15px;
                            border-bottom: 1px solid #eee;
                            background: #f8f9fa;
                            border-radius: 8px 8px 0 0;
                            font-weight: bold;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        ">
                            <span>é€šçŸ¥</span>
                            <div>
                                <button id="mark-all-read" style="
                                    background: #4CAF50;
                                    color: white;
                                    border: none;
                                    padding: 4px 8px;
                                    border-radius: 4px;
                                    cursor: pointer;
                                    font-size: 12px;
                                    margin-right: 5px;
                                ">å…¨ã¦æ—¢èª­</button>
                                <button id="clear-notifications" style="
                                    background: #f44336;
                                    color: white;
                                    border: none;
                                    padding: 4px 8px;
                                    border-radius: 4px;
                                    cursor: pointer;
                                    font-size: 12px;
                                ">ã‚¯ãƒªã‚¢</button>
                            </div>
                        </div>
                        <div id="notification-list">
                            <div style="padding: 20px; text-align: center; color: #666;">
                                é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é€šçŸ¥è¨­å®šãƒ‘ãƒãƒ« -->
                <div id="notification-settings" style="display: none;">
                    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10002;" id="settings-overlay"></div>
                    <div style="
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        padding: 20px;
                        border-radius: 8px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                        z-index: 10003;
                        width: 400px;
                    ">
                        <h3>é€šçŸ¥è¨­å®š</h3>
                        <div style="margin: 15px 0;">
                            <label>
                                <input type="checkbox" id="desktop-notifications" checked>
                                ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹
                            </label>
                        </div>
                        <div style="margin: 15px 0;">
                            <label>
                                <input type="checkbox" id="sound-notifications" checked>
                                ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹
                            </label>
                        </div>
                        <div style="margin: 15px 0;">
                            <label>
                                ãƒã‚§ãƒƒã‚¯é–“éš”:
                                <select id="check-interval">
                                    <option value="30">30ç§’</option>
                                    <option value="60" selected>1åˆ†</option>
                                    <option value="300">5åˆ†</option>
                                    <option value="600">10åˆ†</option>
                                </select>
                            </label>
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button id="close-settings" style="
                                background: #2196F3;
                                color: white;
                                border: none;
                                padding: 8px 16px;
                                border-radius: 4px;
                                cursor: pointer;
                            ">é–‰ã˜ã‚‹</button>
                        </div>
                    </div>
                </div>
            `;

            $('body').append(notificationHtml);
            this.bindEvents();
            this.updateNotificationCount();
        },

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‰
        bindEvents: function() {
            var self = this;

            $('#notification-bell').click(function() {
                $('#notification-dropdown').toggle();
                if ($('#notification-dropdown').is(':visible')) {
                    self.markAllAsRead();
                }
            });

            // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‰ã˜ã‚‹
            $(document).click(function(e) {
                if (!$(e.target).closest('#notification-system').length) {
                    $('#notification-dropdown').hide();
                }
            });

            $('#mark-all-read').click(function() {
                self.markAllAsRead();
            });

            $('#clear-notifications').click(function() {
                self.clearAllNotifications();
            });

            // è¨­å®šãƒœã‚¿ãƒ³ï¼ˆé•·æŠ¼ã—ï¼‰
            var pressTimer;
            $('#notification-bell').mousedown(function() {
                pressTimer = window.setTimeout(function() {
                    $('#notification-settings').show();
                }, 1000);
            }).mouseup(function() {
                clearTimeout(pressTimer);
            });

            $('#settings-overlay, #close-settings').click(function() {
                $('#notification-settings').hide();
            });
        },

        // é€šçŸ¥ã‚’è¿½åŠ 
        addNotification: function(title, message, type, url) {
            var notification = {
                id: Date.now(),
                title: title,
                message: message,
                type: type || 'info',
                url: url,
                timestamp: new Date(),
                read: false
            };

            this.notifications.unshift(notification);
            this.notifications = this.notifications.slice(0, 50); // æœ€å¤§50ä»¶
            this.saveNotifications();
            this.updateNotificationList();
            this.updateNotificationCount();
            this.showDesktopNotification(notification);
            this.playNotificationSound();
        },

        // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥
        showDesktopNotification: function(notification) {
            if (!$('#desktop-notifications').is(':checked')) return;

            if (Notification.permission === 'granted') {
                var n = new Notification(notification.title, {
                    body: notification.message,
                    icon: '/favicon.ico',
                    badge: '/favicon.ico'
                });

                n.onclick = function() {
                    window.focus();
                    if (notification.url) {
                        window.location.href = notification.url;
                    }
                    n.close();
                };

                setTimeout(function() {
                    n.close();
                }, 5000);
            }
        },

        // ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥
        playNotificationSound: function() {
            if (!$('#sound-notifications').is(':checked')) return;

            try {
                var audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmUSBT2P1vPNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmUS');
                audio.play();
            } catch(e) {
                // ã‚µã‚¦ãƒ³ãƒ‰å†ç”Ÿã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
            }
        },

        // é€šçŸ¥è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        requestNotificationPermission: function() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        },

        // é€šçŸ¥ãƒªã‚¹ãƒˆæ›´æ–°
        updateNotificationList: function() {
            var $list = $('#notification-list');
            if (this.notifications.length === 0) {
                $list.html('<div style="padding: 20px; text-align: center; color: #666;">é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“</div>');
                return;
            }

            var html = '';
            this.notifications.forEach(function(notification) {
                var typeColor = {
                    'info': '#2196F3',
                    'success': '#4CAF50',
                    'warning': '#ff9800',
                    'error': '#f44336'
                }[notification.type] || '#2196F3';

                var timeStr = new Date(notification.timestamp).toLocaleString('ja-JP');

                html += `
                    <div class="notification-item" data-id="${notification.id}" style="
                        padding: 12px 15px;
                        border-bottom: 1px solid #eee;
                        cursor: ${notification.url ? 'pointer' : 'default'};
                        background: ${notification.read ? '#fff' : '#f0f8ff'};
                        transition: background 0.2s;
                    ">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="
                                width: 8px;
                                height: 8px;
                                background: ${typeColor};
                                border-radius: 50%;
                                margin-top: 6px;
                                margin-right: 10px;
                                flex-shrink: 0;
                            "></div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: ${notification.read ? 'normal' : 'bold'}; margin-bottom: 4px;">
                                    ${notification.title}
                                </div>
                                <div style="color: #666; font-size: 13px; margin-bottom: 4px;">
                                    ${notification.message}
                                </div>
                                <div style="color: #999; font-size: 11px;">
                                    ${timeStr}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            $list.html(html);

            // é€šçŸ¥ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            $('.notification-item').click(function() {
                var id = parseInt($(this).data('id'));
                var notification = NotificationSystem.notifications.find(n => n.id === id);
                if (notification && notification.url) {
                    window.location.href = notification.url;
                }
            });
        },

        // é€šçŸ¥ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
        updateNotificationCount: function() {
            this.unreadCount = this.notifications.filter(n => !n.read).length;
            var $count = $('#notification-count');

            if (this.unreadCount > 0) {
                $count.text(this.unreadCount > 99 ? '99+' : this.unreadCount).show();
                $('#notification-bell').css('animation', 'notification-pulse 2s infinite');
            } else {
                $count.hide();
                $('#notification-bell').css('animation', '');
            }
        },

        // å…¨ã¦æ—¢èª­ã«ã™ã‚‹
        markAllAsRead: function() {
            this.notifications.forEach(function(n) {
                n.read = true;
            });
            this.saveNotifications();
            this.updateNotificationList();
            this.updateNotificationCount();
        },

        // å…¨é€šçŸ¥ã‚’ã‚¯ãƒªã‚¢
        clearAllNotifications: function() {
            this.notifications = [];
            this.saveNotifications();
            this.updateNotificationList();
            this.updateNotificationCount();
        },

        // é€šçŸ¥ã‚’ä¿å­˜
        saveNotifications: function() {
            try {
                localStorage.setItem(this.storageKey, JSON.stringify(this.notifications));
                localStorage.setItem(this.storageKey + '_lastCheck', this.lastCheck.getTime());
            } catch(e) {
                console.warn('é€šçŸ¥ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }
        },

        // é€šçŸ¥ã‚’èª­ã¿è¾¼ã¿
        loadNotifications: function() {
            try {
                var stored = localStorage.getItem(this.storageKey);
                if (stored) {
                    this.notifications = JSON.parse(stored);
                    // å¤ã„é€šçŸ¥ã‚’å‰Šé™¤ï¼ˆ7æ—¥ä»¥ä¸Šå‰ï¼‰
                    var weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                    this.notifications = this.notifications.filter(function(n) {
                        return new Date(n.timestamp) > weekAgo;
                    });
                }

                var lastCheckStored = localStorage.getItem(this.storageKey + '_lastCheck');
                if (lastCheckStored) {
                    this.lastCheck = new Date(parseInt(lastCheckStored));
                }
            } catch(e) {
                console.warn('é€šçŸ¥ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                this.notifications = [];
            }
        },

        // å®šæœŸãƒã‚§ãƒƒã‚¯é–‹å§‹
        startPeriodicCheck: function() {
            var self = this;

            function checkForUpdates() {
                // ãƒã‚±ãƒƒãƒˆã®æ›´æ–°ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
                if (window.location.pathname.match(/\/issues\/\d+$/)) {
                    var issueId = window.location.pathname.match(/\/issues\/(\d+)$/)[1];
                    self.checkIssueUpdates(issueId);
                }

                // ãƒ†ã‚¹ãƒˆé€šçŸ¥ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
                if (Math.random() < 0.1) { // 10%ã®ç¢ºç‡ã§ãƒ†ã‚¹ãƒˆé€šçŸ¥
                    self.addTestNotification();
                }
            }

            // åˆå›ãƒã‚§ãƒƒã‚¯
            setTimeout(checkForUpdates, 5000);

            // å®šæœŸãƒã‚§ãƒƒã‚¯è¨­å®š
            setInterval(function() {
                var interval = parseInt($('#check-interval').val() || 60) * 1000;
                checkForUpdates();
            }, parseInt($('#check-interval').val() || 60) * 1000);
        },

        // ãƒã‚±ãƒƒãƒˆæ›´æ–°ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        checkIssueUpdates: function(issueId) {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€Redmine APIã‚’ä½¿ç”¨ã—ã¦æ›´æ–°ã‚’ãƒã‚§ãƒƒã‚¯
            // ã“ã“ã§ã¯ç°¡æ˜“ç‰ˆã¨ã—ã¦ã€ãƒšãƒ¼ã‚¸ã®æ›´æ–°æ—¥æ™‚ã‚’ãƒã‚§ãƒƒã‚¯
            var $updated = $('.details .updated');
            if ($updated.length > 0) {
                var updatedText = $updated.text();
                var key = 'issue_' + issueId + '_updated';
                var lastSeen = localStorage.getItem(key);

                if (lastSeen && lastSeen !== updatedText) {
                    this.addNotification(
                        'ãƒã‚±ãƒƒãƒˆæ›´æ–°',
                        'ãƒã‚±ãƒƒãƒˆ #' + issueId + ' ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ',
                        'info',
                        window.location.href
                    );
                }
                localStorage.setItem(key, updatedText);
            }
        },

        // ãƒ†ã‚¹ãƒˆé€šçŸ¥è¿½åŠ 
        addTestNotification: function() {
            var messages = [
                'ãƒã‚±ãƒƒãƒˆ #123 ã«ã‚³ãƒ¡ãƒ³ãƒˆãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ',
                'æ–°ã—ã„ãƒã‚±ãƒƒãƒˆ #124 ãŒä½œæˆã•ã‚Œã¾ã—ãŸ',
                'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ Alpha ã®é€²æ—ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ',
                'ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸ'
            ];

            var types = ['info', 'success', 'warning'];
            var message = messages[Math.floor(Math.random() * messages.length)];
            var type = types[Math.floor(Math.random() * types.length)];

            this.addNotification('Redmineé€šçŸ¥', message, type, '/issues');
        }
    };

    // CSSè¿½åŠ 
    $('<style>').text(`
        @keyframes notification-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .notification-item:hover {
            background: #e3f2fd !important;
        }

        #notification-dropdown::-webkit-scrollbar {
            width: 6px;
        }

        #notification-dropdown::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        #notification-dropdown::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        #notification-dropdown::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    `).appendTo('head');

    // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
    if (typeof window.current_user_id === 'undefined') {
        window.current_user_id = $('body').attr('data-user-id') || 'anonymous';
    }

    NotificationSystem.init();

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹ï¼ˆä»–ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ä½¿ç”¨å¯èƒ½ï¼‰
    window.RedmineNotifications = NotificationSystem;

    // 5ç§’å¾Œã«ã‚¦ã‚§ãƒ«ã‚«ãƒ é€šçŸ¥
    setTimeout(function() {
        NotificationSystem.addNotification(
            'Redmineé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ',
            'é€šçŸ¥æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’é•·æŠ¼ã—ã§è¨­å®šã§ãã¾ã™ã€‚',
            'success'
        );
    }, 5000);
});
```

### 2. é€šçŸ¥ã‚¹ã‚¿ã‚¤ãƒ«æ‹¡å¼µï¼ˆCSSï¼‰

#### åŸºæœ¬è¨­å®š
- **åå‰**: é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚¹ã‚¿ã‚¤ãƒ«
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¿ã‚¤ãƒ—**: CSS
- **æŒ¿å…¥ä½ç½®**: html_head
- **ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³**: `.*`

#### CSS ã‚³ãƒ¼ãƒ‰

```css
/* é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
.redmine-notification-toast {
    position: fixed;
    top: 80px;
    right: 20px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    padding: 15px;
    max-width: 300px;
    z-index: 10004;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
}

.redmine-notification-toast.show {
    opacity: 1;
    transform: translateX(0);
}

.redmine-notification-toast.success {
    border-left: 4px solid #4CAF50;
}

.redmine-notification-toast.warning {
    border-left: 4px solid #ff9800;
}

.redmine-notification-toast.error {
    border-left: 4px solid #f44336;
}

.redmine-notification-toast.info {
    border-left: 4px solid #2196F3;
}

/* é€šçŸ¥é ˜åŸŸã®èª¿æ•´ */
#notification-system {
    font-family: 'Helvetica Neue', Arial, sans-serif;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
    #notification-system {
        top: 5px;
        right: 5px;
    }

    #notification-dropdown {
        width: 280px;
        right: -10px;
    }

    .redmine-notification-toast {
        right: 10px;
        max-width: 250px;
        font-size: 14px;
    }
}

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
@media (prefers-color-scheme: dark) {
    #notification-dropdown {
        background: #333;
        border-color: #555;
        color: #fff;
    }

    #notification-header {
        background: #404040;
        border-bottom-color: #555;
    }

    .notification-item {
        border-bottom-color: #555;
    }

    .notification-item:not([style*="background: #fff"]) {
        background: #2a2a2a !important;
    }

    .redmine-notification-toast {
        background: #333;
        border-color: #555;
        color: #fff;
    }
}

/* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ */
.notification-item:focus {
    outline: 2px solid #2196F3;
    outline-offset: -2px;
}

button:focus {
    outline: 2px solid #2196F3;
    outline-offset: 1px;
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ– */
@media (prefers-reduced-motion: reduce) {
    #notification-bell,
    .redmine-notification-toast,
    .notification-item {
        transition: none;
    }

    #notification-bell {
        animation: none !important;
    }
}
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬æ“ä½œ

1. **é€šçŸ¥ç¢ºèª**
   - ç”»é¢å³ä¸Šã®ğŸ””ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - æœªèª­é€šçŸ¥æ•°ãŒã‚¢ã‚¤ã‚³ãƒ³ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹

2. **é€šçŸ¥è¨­å®š**
   - ğŸ””ã‚¢ã‚¤ã‚³ãƒ³ã‚’1ç§’é–“é•·æŠ¼ã—
   - ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥ã€ã‚µã‚¦ãƒ³ãƒ‰ã€ãƒã‚§ãƒƒã‚¯é–“éš”ã‚’è¨­å®š

3. **é€šçŸ¥ç®¡ç†**
   - ã€Œå…¨ã¦æ—¢èª­ã€ï¼šå…¨é€šçŸ¥ã‚’æ—¢èª­çŠ¶æ…‹ã«
   - ã€Œã‚¯ãƒªã‚¢ã€ï¼šé€šçŸ¥å±¥æ­´ã‚’å…¨å‰Šé™¤

### é«˜åº¦ãªæ©Ÿèƒ½

1. **ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥ã®è¿½åŠ **
   ```javascript
   // JavaScript ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
   window.RedmineNotifications.addNotification(
       'ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥',
       'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™',
       'success',
       '/issues'
   );
   ```

2. **å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº**
   - WebhookçµŒç”±ã§ã®é€šçŸ¥å—ä¿¡
   - APIé€£æºã«ã‚ˆã‚‹è‡ªå‹•é€šçŸ¥ç”Ÿæˆ

## æ©Ÿèƒ½è©³ç´°

### é€šçŸ¥ã‚¿ã‚¤ãƒ—
- **info**: ä¸€èˆ¬æƒ…å ±ï¼ˆé’ï¼‰
- **success**: æˆåŠŸãƒ»å®Œäº†ï¼ˆç·‘ï¼‰
- **warning**: è­¦å‘Šï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
- **error**: ã‚¨ãƒ©ãƒ¼ï¼ˆèµ¤ï¼‰

### ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®é€šçŸ¥å±¥æ­´
- **è‡ªå‹•å‰Šé™¤**: 7æ—¥çµŒéã—ãŸé€šçŸ¥ã¯è‡ªå‹•å‰Šé™¤
- **æœ€å¤§ä¿å­˜**: 50ä»¶ã¾ã§ä¿å­˜

### ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆ
- **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥**: Chrome, Firefox, Safari, Edge
- **ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥**: HTML5 Audioå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶
- **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: IE8+, å…¨ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚ªãƒ—ã‚·ãƒ§ãƒ³

### é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã§è‡ªå‹•é€šçŸ¥ã‚’è¨­å®šã™ã‚‹å ´åˆï¼š

```javascript
// ãƒã‚±ãƒƒãƒˆä½œæˆå®Œäº†ãƒšãƒ¼ã‚¸ã§æˆåŠŸé€šçŸ¥
if (window.location.pathname.match(/\/issues\/\d+$/) &&
    document.referrer.includes('/issues/new')) {
    window.RedmineNotifications.addNotification(
        'ãƒã‚±ãƒƒãƒˆä½œæˆå®Œäº†',
        'æ–°ã—ã„ãƒã‚±ãƒƒãƒˆãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ',
        'success',
        window.location.href
    );
}
```

### ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚„ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ï¼š

```css
#notification-bell {
    background: #4CAF50 !important; /* ç·‘è‰²ã«å¤‰æ›´ */
    font-size: 18px; /* ã‚µã‚¤ã‚ºå¤‰æ›´ */
}
```

### çµ±åˆã‚ªãƒ—ã‚·ãƒ§ãƒ³

1. **Slackã¨ã®é€£æº**
   - Incoming Webhookä½¿ç”¨
   - é‡è¦é€šçŸ¥ã®Slackè»¢é€

2. **ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã¨ã®ä½µç”¨**
   - æ—¢å­˜ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã¯ç¶­æŒ
   - ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ã§è£œå®Œ

3. **ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ**
   - PWAå¯¾å¿œã§ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
   - ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶æœ€é©åŒ–

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®JavaScriptãŒæœ‰åŠ¹ã‹ç¢ºèª
2. View Customizeã®è¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

### ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥ãŒå‹•ä½œã—ãªã„å ´åˆ
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥è¨±å¯ã‚’ç¢ºèª
2. ã‚·ã‚¹ãƒ†ãƒ ã®é€šçŸ¥è¨­å®šã‚’ç¢ºèª
3. HTTPSã§ã®æ¥ç¶šãŒæ¨å¥¨

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ
1. é€šçŸ¥å±¥æ­´ãŒå¤šã™ãã‚‹å ´åˆã¯ã€Œã‚¯ãƒªã‚¢ã€å®Ÿè¡Œ
2. ãƒã‚§ãƒƒã‚¯é–“éš”ã‚’é•·ãè¨­å®š
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª

---

**å°å…¥å®Œäº†æ—¥**: 2025å¹´9æœˆ26æ—¥
**å¯¾å¿œãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Redmine 6.0.6 + View Customize Plugin
**å®Ÿè£…æ–¹æ³•**: JavaScript + CSS + ãƒ–ãƒ©ã‚¦ã‚¶API